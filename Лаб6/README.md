# Практическая работа 006
gribanovaaalya@yandex.ru

## Название

Исследование вредоносной активности в домене Windows

## Цель работы

1.  Закрепить навыки исследования данных журнала Windows Active
    Directory
2.  Изучить структуру журнала системы Windows Active Directory
3.  Зекрепить практические навыки использования языка программирования R
    для обработки данных
4.  Закрепить знания основных функций обработки данных экосистемы
    tidyverse языка R

## Исходные данные

1.  Ноутбук с ОС Windows 10
2.  Rstudio Desktop
3.  Интерпретатор R 4.5.1

## Задание

Используя программный пакет dplyr языка программирования R провести
анализ журналов и ответить на вопросы

## План выполнения

1.  Подготовить данные
2.  Провести анализ данных

## Описание шагов

### Шаг 1

Подключим необходимые библиотеки:

``` r
library(dplyr)
```

    Warning: пакет 'dplyr' был собран под R версии 4.5.2


    Присоединяю пакет: 'dplyr'

    Следующие объекты скрыты от 'package:stats':

        filter, lag

    Следующие объекты скрыты от 'package:base':

        intersect, setdiff, setequal, union

``` r
library(tidyverse)
```

    Warning: пакет 'tidyverse' был собран под R версии 4.5.2

    Warning: пакет 'ggplot2' был собран под R версии 4.5.2

    Warning: пакет 'tidyr' был собран под R версии 4.5.2

    Warning: пакет 'readr' был собран под R версии 4.5.2

    Warning: пакет 'purrr' был собран под R версии 4.5.2

    Warning: пакет 'forcats' был собран под R версии 4.5.2

    Warning: пакет 'lubridate' был собран под R версии 4.5.2

    ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ✔ forcats   1.0.1     ✔ readr     2.1.6
    ✔ ggplot2   4.0.1     ✔ stringr   1.5.2
    ✔ lubridate 1.9.4     ✔ tibble    3.3.0
    ✔ purrr     1.2.0     ✔ tidyr     1.3.1
    ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ✖ dplyr::filter() masks stats::filter()
    ✖ dplyr::lag()    masks stats::lag()
    ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(jsonlite)
```

    Warning: пакет 'jsonlite' был собран под R версии 4.5.2


    Присоединяю пакет: 'jsonlite'

    Следующий объект скрыт от 'package:purrr':

        flatten

Выполним подготовку данных:

#### 1. Импортируем данные:

``` r
untar(tarfile = "dataset.tar.gz", exdir = "./")
data <- stream_in(file("caldera_attack_evals_round1_day1_2019-10-20201108.json"), verbose = FALSE)
```

#### 2. Приведем датасет в вид “аккуратных данных”, преобразуем типы столбцов в соответствии с типом данных:

``` r
data <- data %>%
  rename(
    timestamp = 1,
    metadata = 2) %>%
  mutate(
    timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC"))
```

#### 3. Посмотрим общую структуру данных:

``` r
glimpse(data)
```

    Rows: 101,904
    Columns: 9
    $ timestamp <dttm> 2019-10-20 20:11:06, 2019-10-20 20:11:07, 2019-10-20 20:11:…
    $ metadata  <df[,4]> <data.frame[26 x 4]>
    $ event     <df[,4]> <data.frame[26 x 4]>
    $ log       <df[,1]> <data.frame[26 x 1]>
    $ message   <chr> "A token right was adjusted.\n\nSubject:\n\tSecurity ID:\…
    $ winlog    <df[,16]> <data.frame[26 x 16]>
    $ ecs       <df[,1]> <data.frame[26 x 1]>
    $ host      <df[,1]> <data.frame[26 x 1]>
    $ agent     <df[,5]> <data.frame[26 x 5]>

### Шаг 2

Проведем анализ данных:

#### 1. Раскроем датафрейм, избавившись от вложенных датафреймов:

``` r
data <- unnest(
  data,
  cols = c(metadata, event, log, winlog, ecs, host, agent), 
  names_sep = "_")
data <- unnest(
  data,
  cols = c(winlog_event_data, winlog_process, winlog_user, winlog_user_data),
  names_sep = "_") %>%
  mutate(
    event_created = as.POSIXct(event_created, format = "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC"))
```

Посмотрим общую структуру данных:

``` r
glimpse(data)
```

    Rows: 101,904
    Columns: 300
    $ timestamp                                   <dttm> 2019-10-20 20:11:06, 2019…
    $ metadata_beat                               <chr> "winlogbeat", "winlogbeat"…
    $ metadata_type                               <chr> "_doc", "_doc", "_doc", "_…
    $ metadata_version                            <chr> "7.4.0", "7.4.0", "7.4.0",…
    $ metadata_topic                              <chr> "winlogbeat", "winlogbeat"…
    $ event_created                               <dttm> 2019-10-20 20:11:09, 2019…
    $ event_kind                                  <chr> "event", "event", "event",…
    $ event_code                                  <int> 4703, 4673, 10, 10, 10, 10…
    $ event_action                                <chr> "Token Right Adjusted Even…
    $ log_level                                   <chr> "information", "informatio…
    $ message                                     <chr> "A token right was adjuste…
    $ winlog_event_data_SubjectDomainName         <chr> "shire", "NT AUTHORITY", N…
    $ winlog_event_data_TargetDomainName          <chr> "shire", NA, NA, NA, NA, N…
    $ winlog_event_data_SubjectUserSid            <chr> "S-1-5-18", "S-1-5-19", NA…
    $ winlog_event_data_SubjectUserName           <chr> "HR001$", "LOCAL SERVICE",…
    $ winlog_event_data_TargetUserName            <chr> "HR001$", NA, NA, NA, NA, …
    $ winlog_event_data_EnabledPrivilegeList      <chr> "SeTakeOwnershipPrivilege"…
    $ winlog_event_data_TargetLogonId             <chr> "0x3e7", NA, NA, NA, NA, N…
    $ winlog_event_data_ProcessName               <chr> "C:\\Windows\\System32\\sv…
    $ winlog_event_data_ProcessId                 <chr> "0x804", "0x494", NA, NA, …
    $ winlog_event_data_SubjectLogonId            <chr> "0x3e7", "0x3e5", NA, NA, …
    $ winlog_event_data_TargetUserSid             <chr> "S-1-5-18", NA, NA, NA, NA…
    $ winlog_event_data_DisabledPrivilegeList     <chr> "-", NA, NA, NA, NA, NA, N…
    $ winlog_event_data_ObjectServer              <chr> NA, "Security", NA, NA, NA…
    $ winlog_event_data_Service                   <chr> NA, "-", NA, NA, NA, NA, N…
    $ winlog_event_data_PrivilegeList             <chr> NA, "SeProfileSingleProces…
    $ winlog_event_data_TargetProcessId           <chr> NA, NA, "3108", "1968", "2…
    $ winlog_event_data_SourceProcessId           <chr> NA, NA, "3556", "3548", "3…
    $ winlog_event_data_SourceProcessGUID         <chr> NA, NA, "{a158f72c-afec-5d…
    $ winlog_event_data_SourceThreadId            <chr> NA, NA, "3688", "3660", "3…
    $ winlog_event_data_SourceImage               <chr> NA, NA, "C:\\Windows\\Syst…
    $ winlog_event_data_CallTrace                 <chr> NA, NA, "C:\\Windows\\SYST…
    $ winlog_event_data_TargetProcessGUID         <chr> NA, NA, "{a158f72c-afeb-5d…
    $ winlog_event_data_TargetImage               <chr> NA, NA, "C:\\Program Files…
    $ winlog_event_data_GrantedAccess             <chr> NA, NA, "0x1400", "0x1400"…
    $ winlog_event_data_UtcTime                   <chr> NA, NA, "2019-10-20 20:11:…
    $ winlog_event_data_ProcessGuid               <chr> NA, NA, NA, NA, NA, NA, "{…
    $ winlog_event_data_Image                     <chr> NA, NA, NA, NA, NA, NA, "C…
    $ winlog_event_data_TargetFilename            <chr> NA, NA, NA, NA, NA, NA, "C…
    $ winlog_event_data_CreationUtcTime           <chr> NA, NA, NA, NA, NA, NA, "2…
    $ winlog_event_data_FileVersion               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Company                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Signed                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Signature                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OriginalFileName          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Description               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Product                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ImageLoaded               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SignatureStatus           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Hashes                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Status                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Protocol                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_FilterRTID                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LayerName                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LayerRTID                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Application               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceAddress             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourcePort                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ProcessID                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestPort                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RemoteMachineID           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RemoteUserID              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Direction                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestAddress               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RestrictedAdminMode       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TransmittedServices       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LogonType                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_WorkstationName           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LmPackageName             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_KeyLength                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LogonGuid                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ImpersonationLevel        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetOutboundDomainName  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetLinkedLogonId       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AuthenticationPackageName <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetOutboundUserName    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_VirtualAccount            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IpAddress                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ElevatedToken             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LogonProcessName          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IpPort                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_GroupMembership           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EventIdx                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EventCountTotal           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EventType                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetObject              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationPort           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationIsIpv6         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceIp                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_User                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceIsIpv6              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationIp             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceHostname            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationHostname       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationPortName       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Initiated                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param3                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param2                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param1                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentProcessId           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentProcessGuid         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentCommandLine         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CommandLine               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CurrentDirectory          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TerminalSessionId         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentImage               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LogonId                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IntegrityLevel            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PipeName                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ScriptBlockId             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RunspaceId                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ContextInfo               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Payload                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MessageNumber             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MessageTotal              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ScriptBlockText           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewProcessId              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewProcessName            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MandatoryLabel            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentProcessName         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TokenElevationType        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ServiceName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ServiceSid                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TicketOptions             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TicketEncryptionType      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_QueryName                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_QueryStatus               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_QueryResults              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourcePortName            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Device                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Details                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ObjectName                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OldSd                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewSd                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ObjectType                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_HandleId                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShareName                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AccessList                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShareLocalPath            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AccessMask                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AccessReason              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RelativeTargetName        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Properties                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AdditionalInfo2           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OperationType             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AdditionalInfo            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Path                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetHandleId            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceHandleId            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TransactionId             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RestrictedSidCount        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ResourceAttributes        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Binary                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PreviousCreationUtcTime   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CallerProcessId           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CallerProcessName         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetSid                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TaskName                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TaskContentNew            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceProcessGuid         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetProcessGuid         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StartAddress              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewThreadId               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TaskContent               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PackageName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Workstation               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param4                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param5                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param7                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StartModule               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StartFunction             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TSId                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_UserSid                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PreAuthType               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PreviousTime              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewTime                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_InterfaceName             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OldProfile                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewProfile                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_InterfaceGuid             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SettingType               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SettingValueSize          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SettingValue              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SettingValueDisplay       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Origin                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ModifyingUser             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Reason                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OldTime                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DwordVal                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param6                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShutdownActionType        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShutdownEventCode         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShutdownReason            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StopTime                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BootMode                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StartTime                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MajorVersion              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MinorVersion              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BuildVersion              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_QfeVersion                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ServiceVersion            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EnableDisableReason       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_VsmPolicy                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LastBootGood              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LastBootId                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BootStatusPolicy          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LastShutdownGood          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BootMenuPolicy            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BootType                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LoadOptions               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EntryCount                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BitlockerUserInputTime    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CountNew                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CountOld                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_UpdateReason              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EnabledNew                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceNameLength          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceName                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceTime                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_FinalStatus               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceVersionMajor        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceVersionMinor        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DriveName                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CorruptionActionState     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_State                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MinimumPerformancePercent <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MaximumPerformancePercent <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PerformanceImplementation <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Group                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Number                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IdleStateCount            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IdleImplementation        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NominalFrequency          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MinimumThrottlePercent    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Config                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IsTestConfig              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ `winlog_event_data_Default SD String:`      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AdapterSuffixName         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DnsServerList             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ `winlog_event_data_Sent UpdateServer`       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Ipaddress                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ErrorCode                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AdapterName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_HostName                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TimeSource                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_id                             <int> 4703, 4673, 10, 10, 10, 10…
    $ winlog_provider_name                        <chr> "Microsoft-Windows-Securit…
    $ winlog_api                                  <chr> "wineventlog", "wineventlo…
    $ winlog_record_id                            <int> 50588, 104875, 226649, 153…
    $ winlog_computer_name                        <chr> "HR001.shire.com", "HFDC01…
    $ winlog_process_pid                          <int> 4, 4, 3220, 3136, 3184, 31…
    $ winlog_process_thread                       <df[,1]> <data.frame[26 x 1]>
    $ winlog_keywords                             <list> "Audit Success", "Audit…
    $ winlog_provider_guid                        <chr> "{54849625-5478-4994-a5ba…
    $ winlog_channel                              <chr> "security", "Security", "M…
    $ winlog_task                                 <chr> "Token Right Adjusted Even…
    $ winlog_opcode                               <chr> "Info", "Info", "Info", "I…
    $ winlog_version                              <int> NA, NA, 3, 3, 3, 3, 2, 3, …
    $ winlog_user_domain                          <chr> NA, NA, "NT AUTHORITY", "N…
    $ winlog_user_type                            <chr> NA, NA, "User", "User", "U…
    $ winlog_user_identifier                      <chr> NA, NA, "S-1-5-18", "S-1-5…
    $ winlog_user_name                            <chr> NA, NA, "SYSTEM", "SYSTEM"…
    $ winlog_activity_id                          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ProcessID                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ProviderPath               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_xml_name                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ProviderName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Code                       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_HostProcess                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Id                         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_PossibleCause              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ClientProcessId            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Component                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Operation                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_User                       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ResultCode                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ClientMachine              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_SessionID                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ESS                        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_CONSUMER                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Namespace                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Processid                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_NamespaceName              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Query                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Provider                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_queryid                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Session                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Reason                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Address                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_messageName                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ListenerName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Class                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_listenerName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ ecs_version                                 <chr> "1.1.0", "1.1.0", "1.1.0",…
    $ host_name                                   <chr> "WECServer", "WECServer", …
    $ agent_ephemeral_id                          <chr> "b372be1f-ba0a-4d7e-b4df-7…
    $ agent_hostname                              <chr> "WECServer", "WECServer", …
    $ agent_id                                    <chr> "d347d9a4-bff4-476c-b5a4-d…
    $ agent_version                               <chr> "7.4.0", "7.4.0", "7.4.0",…
    $ agent_type                                  <chr> "winlogbeat", "winlogbeat"…

#### 2. Минимизируем количество колонок в датафрейме – уберем колонки с единственным значением параметра:

``` r
data <- data %>%
  select(where(~ n_distinct(.) > 1))

glimpse(data)
```

    Rows: 101,904
    Columns: 287
    $ timestamp                                   <dttm> 2019-10-20 20:11:06, 2019…
    $ event_created                               <dttm> 2019-10-20 20:11:09, 2019…
    $ event_code                                  <int> 4703, 4673, 10, 10, 10, 10…
    $ event_action                                <chr> "Token Right Adjusted Even…
    $ log_level                                   <chr> "information", "informatio…
    $ message                                     <chr> "A token right was adjuste…
    $ winlog_event_data_SubjectDomainName         <chr> "shire", "NT AUTHORITY", N…
    $ winlog_event_data_TargetDomainName          <chr> "shire", NA, NA, NA, NA, N…
    $ winlog_event_data_SubjectUserSid            <chr> "S-1-5-18", "S-1-5-19", NA…
    $ winlog_event_data_SubjectUserName           <chr> "HR001$", "LOCAL SERVICE",…
    $ winlog_event_data_TargetUserName            <chr> "HR001$", NA, NA, NA, NA, …
    $ winlog_event_data_EnabledPrivilegeList      <chr> "SeTakeOwnershipPrivilege"…
    $ winlog_event_data_TargetLogonId             <chr> "0x3e7", NA, NA, NA, NA, N…
    $ winlog_event_data_ProcessName               <chr> "C:\\Windows\\System32\\sv…
    $ winlog_event_data_ProcessId                 <chr> "0x804", "0x494", NA, NA, …
    $ winlog_event_data_SubjectLogonId            <chr> "0x3e7", "0x3e5", NA, NA, …
    $ winlog_event_data_TargetUserSid             <chr> "S-1-5-18", NA, NA, NA, NA…
    $ winlog_event_data_DisabledPrivilegeList     <chr> "-", NA, NA, NA, NA, NA, N…
    $ winlog_event_data_ObjectServer              <chr> NA, "Security", NA, NA, NA…
    $ winlog_event_data_Service                   <chr> NA, "-", NA, NA, NA, NA, N…
    $ winlog_event_data_PrivilegeList             <chr> NA, "SeProfileSingleProces…
    $ winlog_event_data_TargetProcessId           <chr> NA, NA, "3108", "1968", "2…
    $ winlog_event_data_SourceProcessId           <chr> NA, NA, "3556", "3548", "3…
    $ winlog_event_data_SourceProcessGUID         <chr> NA, NA, "{a158f72c-afec-5d…
    $ winlog_event_data_SourceThreadId            <chr> NA, NA, "3688", "3660", "3…
    $ winlog_event_data_SourceImage               <chr> NA, NA, "C:\\Windows\\Syst…
    $ winlog_event_data_CallTrace                 <chr> NA, NA, "C:\\Windows\\SYST…
    $ winlog_event_data_TargetProcessGUID         <chr> NA, NA, "{a158f72c-afeb-5d…
    $ winlog_event_data_TargetImage               <chr> NA, NA, "C:\\Program Files…
    $ winlog_event_data_GrantedAccess             <chr> NA, NA, "0x1400", "0x1400"…
    $ winlog_event_data_UtcTime                   <chr> NA, NA, "2019-10-20 20:11:…
    $ winlog_event_data_ProcessGuid               <chr> NA, NA, NA, NA, NA, NA, "{…
    $ winlog_event_data_Image                     <chr> NA, NA, NA, NA, NA, NA, "C…
    $ winlog_event_data_TargetFilename            <chr> NA, NA, NA, NA, NA, NA, "C…
    $ winlog_event_data_CreationUtcTime           <chr> NA, NA, NA, NA, NA, NA, "2…
    $ winlog_event_data_FileVersion               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Company                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Signed                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Signature                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OriginalFileName          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Description               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Product                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ImageLoaded               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SignatureStatus           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Hashes                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Status                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Protocol                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_FilterRTID                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LayerName                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LayerRTID                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Application               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceAddress             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourcePort                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ProcessID                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestPort                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RemoteMachineID           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RemoteUserID              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Direction                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestAddress               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RestrictedAdminMode       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TransmittedServices       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LogonType                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_WorkstationName           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LmPackageName             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_KeyLength                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LogonGuid                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ImpersonationLevel        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetOutboundDomainName  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetLinkedLogonId       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AuthenticationPackageName <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetOutboundUserName    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_VirtualAccount            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IpAddress                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ElevatedToken             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LogonProcessName          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IpPort                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_GroupMembership           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EventIdx                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EventCountTotal           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EventType                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetObject              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationPort           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationIsIpv6         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceIp                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_User                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceIsIpv6              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationIp             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceHostname            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationHostname       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DestinationPortName       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Initiated                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param3                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param2                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param1                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentProcessId           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentProcessGuid         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentCommandLine         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CommandLine               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CurrentDirectory          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TerminalSessionId         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentImage               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LogonId                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IntegrityLevel            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PipeName                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ScriptBlockId             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RunspaceId                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ContextInfo               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Payload                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MessageNumber             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MessageTotal              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ScriptBlockText           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewProcessId              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewProcessName            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MandatoryLabel            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ParentProcessName         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TokenElevationType        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ServiceName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ServiceSid                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TicketOptions             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TicketEncryptionType      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_QueryName                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_QueryStatus               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_QueryResults              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourcePortName            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Device                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Details                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ObjectName                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OldSd                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewSd                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ObjectType                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_HandleId                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShareName                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AccessList                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShareLocalPath            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AccessMask                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AccessReason              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RelativeTargetName        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Properties                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AdditionalInfo2           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OperationType             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AdditionalInfo            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Path                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetHandleId            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceHandleId            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TransactionId             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_RestrictedSidCount        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ResourceAttributes        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Binary                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PreviousCreationUtcTime   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CallerProcessId           <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CallerProcessName         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetSid                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TaskName                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TaskContentNew            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SourceProcessGuid         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TargetProcessGuid         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StartAddress              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewThreadId               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TaskContent               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PackageName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Workstation               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param4                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param5                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param7                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StartModule               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StartFunction             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TSId                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_UserSid                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PreAuthType               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PreviousTime              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewTime                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_InterfaceName             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OldProfile                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NewProfile                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_InterfaceGuid             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SettingType               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SettingValueSize          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SettingValue              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_SettingValueDisplay       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Origin                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ModifyingUser             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Reason                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_OldTime                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DwordVal                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_param6                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShutdownActionType        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShutdownEventCode         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ShutdownReason            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StopTime                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BootMode                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_StartTime                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MajorVersion              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MinorVersion              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BuildVersion              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_QfeVersion                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ServiceVersion            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EnableDisableReason       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_VsmPolicy                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LastBootGood              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LastBootId                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BootStatusPolicy          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LastShutdownGood          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BootMenuPolicy            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BootType                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_LoadOptions               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EntryCount                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_BitlockerUserInputTime    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CountNew                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CountOld                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_UpdateReason              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_EnabledNew                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceNameLength          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceName                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceTime                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_FinalStatus               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceVersionMajor        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DeviceVersionMinor        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DriveName                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_CorruptionActionState     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_State                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MinimumPerformancePercent <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MaximumPerformancePercent <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_PerformanceImplementation <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Group                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Number                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IdleStateCount            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IdleImplementation        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_NominalFrequency          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_MinimumThrottlePercent    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Config                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_IsTestConfig              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ `winlog_event_data_Default SD String:`      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AdapterSuffixName         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_DnsServerList             <chr> NA, NA, NA, NA, NA, NA, NA…
    $ `winlog_event_data_Sent UpdateServer`       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_Ipaddress                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_ErrorCode                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_AdapterName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_HostName                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_data_TimeSource                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_event_id                             <int> 4703, 4673, 10, 10, 10, 10…
    $ winlog_provider_name                        <chr> "Microsoft-Windows-Securit…
    $ winlog_record_id                            <int> 50588, 104875, 226649, 153…
    $ winlog_computer_name                        <chr> "HR001.shire.com", "HFDC01…
    $ winlog_process_pid                          <int> 4, 4, 3220, 3136, 3184, 31…
    $ winlog_process_thread                       <df[,1]> <data.frame[26 x 1]>
    $ winlog_keywords                             <list> "Audit Success", "Audit…
    $ winlog_provider_guid                        <chr> "{54849625-5478-4994-a5ba…
    $ winlog_channel                              <chr> "security", "Security", "M…
    $ winlog_task                                 <chr> "Token Right Adjusted Even…
    $ winlog_opcode                               <chr> "Info", "Info", "Info", "I…
    $ winlog_version                              <int> NA, NA, 3, 3, 3, 3, 2, 3, …
    $ winlog_user_domain                          <chr> NA, NA, "NT AUTHORITY", "N…
    $ winlog_user_type                            <chr> NA, NA, "User", "User", "U…
    $ winlog_user_identifier                      <chr> NA, NA, "S-1-5-18", "S-1-5…
    $ winlog_user_name                            <chr> NA, NA, "SYSTEM", "SYSTEM"…
    $ winlog_activity_id                          <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ProcessID                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ProviderPath               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_xml_name                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ProviderName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Code                       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_HostProcess                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Id                         <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_PossibleCause              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ClientProcessId            <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Component                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Operation                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_User                       <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ResultCode                 <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ClientMachine              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_SessionID                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ESS                        <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_CONSUMER                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Namespace                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Processid                  <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_NamespaceName              <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Query                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Provider                   <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_queryid                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Session                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Reason                     <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Address                    <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_messageName                <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_ListenerName               <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_Class                      <chr> NA, NA, NA, NA, NA, NA, NA…
    $ winlog_user_data_listenerName               <chr> NA, NA, NA, NA, NA, NA, NA…

#### 3. Определим, какое количество хостов представлено в данном датасете:

``` r
data %>% pull(winlog_computer_name) %>% n_distinct()
```

    [1] 5

#### 4. Подготовим датафрейм с расшифровкой Windows Event_ID, приведем типы данных к типу их значений:

``` r
library(xml2)
```

    Warning: пакет 'xml2' был собран под R версии 4.5.2

``` r
library(rvest)
```

    Warning: пакет 'rvest' был собран под R версии 4.5.2


    Присоединяю пакет: 'rvest'

    Следующий объект скрыт от 'package:readr':

        guess_encoding

``` r
webpage_url <- "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor"
webpage <- xml2::read_html(webpage_url)
event_df <- rvest::html_table(webpage)[[1]]
```

``` r
event_df <- event_df %>%
  rename(
    Current_Windows_Event_ID = 1,
    Legacy_Windows_Event_ID = 2,
    Potential_Criticality = 3,
    Event_Summary = 4) %>%
  mutate (
    Current_Windows_Event_ID = as.integer(Current_Windows_Event_ID),
    Legacy_Windows_Event_ID = as.integer(Legacy_Windows_Event_ID)
  )
```

    Warning: There were 2 warnings in `mutate()`.
    The first warning was:
    ℹ In argument: `Current_Windows_Event_ID =
      as.integer(Current_Windows_Event_ID)`.
    Caused by warning:
    ! в результате преобразования созданы NA
    ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.

``` r
glimpse(event_df)
```

    Rows: 381
    Columns: 4
    $ Current_Windows_Event_ID <int> 4618, 4649, 4719, 4765, 4766, 4794, 4897, 496…
    $ Legacy_Windows_Event_ID  <int> NA, NA, 612, NA, NA, NA, 801, NA, NA, 550, 51…
    $ Potential_Criticality    <chr> "High", "High", "High", "High", "High", "High…
    $ Event_Summary            <chr> "A monitored security event pattern has occur…

#### 5. Определим, есть ли в логе события с высоким и средним уровнем значимости, сколько их:

``` r
result <- data %>%
  left_join(
    event_df %>% select(Current_Windows_Event_ID, Potential_Criticality),
    by = c("winlog_event_id" = "Current_Windows_Event_ID")) %>%
  filter(Potential_Criticality == "High" | Potential_Criticality == "Medium") %>%
  count(Potential_Criticality, .drop = FALSE)

result
```

    # A tibble: 0 × 2
    # ℹ 2 variables: Potential_Criticality <chr>, n <int>

Видим, что таких событий нет

## Вывод

В результате выполнения практической работы были закреплены навыки
исследования данных журнала Windows Active Directory, была изучена
структуру журнала системы Windows Active Directory, зкреплены
практические навыки использования языка программирования R для обработки
данных
